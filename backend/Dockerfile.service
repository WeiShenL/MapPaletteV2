# Universal Dockerfile for all Node.js microservices
FROM node:18-alpine

WORKDIR /app

# Copy the entire backend (including shared)
COPY . .

# Install shared dependencies first
WORKDIR /app/shared
RUN npm install && npx prisma generate || echo "Prisma generation will happen at runtime"

# Go to service directory (will be set by docker-compose working_dir)
WORKDIR /app

# Default command (can be overridden)
CMD ["node", "src/index.js"]
